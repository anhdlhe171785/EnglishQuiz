@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using PRN222_EnglishQuiz.Models

@{
    ViewData["Title"] = "Exam List";
    var exams = ViewBag.Exams as List<Exam>;
    var attemptCounts = ViewBag.ExamAttemptCounts as Dictionary<int, int>;
}

<h2 class="text-center">📚 Exam List</h2>

<div class="exam-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
    @foreach (Exam e in exams)
    {
        <div class="exam-card" style="border: 1px solid #ccc; border-radius: 10px; padding: 15px; background-color: #f9f9f9;">
            <h3 style="color: #007acc;">@e.Title</h3>
            <p>@e.Description</p>

            @if (attemptCounts != null && attemptCounts.TryGetValue(e.Id, out int count))
            {
                if (count == 0)
                {
                    <a asp-controller="Exam" asp-action="TakeExam" asp-route-id="@e.Id"
                       style="color: white; background-color: #007acc; padding: 8px 12px; border-radius: 5px; text-decoration: none;">
                        Take Exam
                    </a>
                }
                else if (count == 1)
                {
                    <a asp-controller="Exam" asp-action="TakeExam" asp-route-id="@e.Id"
                       style="color: white; background-color: #28a745; padding: 8px 12px; border-radius: 5px; text-decoration: none;">
                        Retake Exam
                    </a>
                }
                else
                {
                    <span style="color: gray; font-style: italic;">You have reached the attempt limit</span>
                }
            }
            else
            {
                <a asp-controller="Exam" asp-action="TakeExam" asp-route-id="@e.Id"
                   style="color: white; background-color: #007acc; padding: 8px 12px; border-radius: 5px; text-decoration: none;">
                    Take Exam
                </a>
            }
        </div>
    }
</div>

@if (TempData["LoginSuccess"] != null)
{
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        Swal.fire({
            icon: 'success',
            title: '@TempData["LoginSuccess"]',
            timer: 1500,
            showConfirmButton: false
        });
    </script>
}
